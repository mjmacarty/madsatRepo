<!DOCTYPE html>

<html>
<head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" type="text/css" href="css/jquery-ui-1.10.3.custom.css">        
    
    <title>ajax() Query results</title>
    
    <style>
        table,th, td{
            border: 1px solid;
            padding-left:2px;
                        
        }
        td{
            font-size:10pt;
        }
    </style>
    
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.min.js"></script>
    <script>
         $(document).ready(function(){
            //post to plan.jsp
            var qString = '';
            $('#execute').click(function(){
            qString = $('#query-string').val();
            console.log(qString);
            $.post(
                'plan.jsp',
                {q:qString},
                'xml'
                 ).done(function(data){
                    $.ajax({
               type:'get',
               url:'result.xml',
               beforeSend: function(){$('#query-results').html('<img src="ajax-loader.gif"><br>Loading...'); },
               timeout: 10000,
               error: function(xhr, status, error){
                alert("Error: " + xhr.status + " - " + error)
               },
               dataType: "xml",
               cache:false,
               success: function(data){
                
               var html = '<h3>Query Results</h3>';
               html += '<table><tbody><tr>';
               
               var keys = $(data).find('row:first>*').map(function(){return this.nodeName}).get();
               console.log(keys);
               console.log(keys.length);
               for (i=0; i<keys.length; i++){
               
               html += '<th class="' + keys[i] +'">' + keys[i] + '</th>' 
               }
            html += '</tr>';    
               
                $(data).find('row').each(function(){
                    var row = $(this);
                    
                    html+= '<tr>';
                    $(data).find(row).children().each(function(){
                    
                    html+= '<td>' + $(this).text() + '</td>';
                    
                        }); //end each column
                    
                    html+= '</tr>'
                    });  //end each row
                             
                
               
            
            
            
        $('#query-results').html(html); // Add to DOM
        
                
               }//end success
            
    
            
                              
           });//end ajax
                }); //end wrapper
                 
                 
            
            }); //end ready
            
         });   
           
        
    </script>
    
    </head>
    
    
    <body>
        <div id="query-results"></div>
        <input type="text" size="40" id="query-string">
            <button id="execute">Submit</button>
        
    </body>
</html>
