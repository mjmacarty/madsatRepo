<!DOCTYPE html>

<html lang="en-us">
<head>
<meta charset="utf-8">
<title>MADSAT User Interface</title>
<link rel="stylesheet" type="text/css"
	href="styles/jquery-ui-1.10.3.custom.css" />
<link rel="stylesheet" type="text/css" href="styles/madsat.css" />
<script type="text/javascript" src="b.js"></script>
<script type="text/javascript" src="books/javascript/jquery-1.10.2.js"></script>
<script type="text/javascript"
	src="books/javascript/jquery-ui-1.10.3/js/jquery-ui-1.10.3.custom.js"></script>

<script type="text/javascript">
	$(document).ready(function() {
		$("#tabs").tabs();
	});

	$(document).ready(function() {
		$('#a-translate').click(function() {
			this.disabled = true;
			transFunction();
		});
	});

	$(document).ready(function() {
		$('#a-string').click(function() {
			auto_Function();
		});
	});

	$(document).ready(function() {
		$('#selectable').selectable(function() {
		});
	});

	$(document).ready(function() {
		$('#a-execute').click(function() {
			this.disabled = true;
			execFunction();
		});
	});
</script>


</head>
<body>
	<!-- tabbed UI component allows user to select all preferences before execution -->
	<div id="tabs">
		<ul>
			<li><a href="#tabs1">Library</a></li>
			<li><a href="#tabs2">Analytics</a></li>
		</ul>

		<div id="tabs1">
			<h1>Canned library</h1>
			<p class="description">Library of predefined queries. Select
				database and desired query by typing in text boxes.</p>

			<label for="a-database-list">Select Domain:</label><br> <select
				id="a-database-list" style="width: 150px; height: 25px;">
				<option value="null" selected>Select...</option>
				<option value="geoquery">geoquery</option>
				<option value="madsat">madsat</option>
				<option value="madsatBIG">madsatBIG</option>
				<option value="saluteBIG">saluteBIG</option>
				<option value="test">test</option>
			</select> <br> <br> <label for="a-string">Enter query: </label><br>
			<input type="text" id="a-string" size="30"><br> <br>
			<button id="a-translate">Translate</button>
			<div id="ul-container">
				<ul id="selectable">
					<li>Translated Queries</li>
				</ul>
			</div>

			<button id="a-execute">Execute</button>
		</div>

		<!-- Analytics models -->
		<div id="tabs2">
			<h1>Analytics</h1>
			<label for="model-database-list">Select Data Source:</label><br>
			<select id="model-database-list" style="width: 150px; height: 25px;">
				<option value="null" selected>Select...</option>
				<option value="accumulo">accumulo</option>
				<option value="cloudbase">cloudbase</option>
				<option value="geoquery">geoquery</option>
				<option value="madsat">madsat</option>
				<option value="madsatBIG">madsatBIG</option>
				<option value="mysql">mysql</option>
				<option value="saluteBIG">saluteBIG</option>
				<option value="test">test</option>
			</select> <br> <br>
			<p class="description">Select a model to evaluate</p>
			<select id="model-list" style="width: 250px; height: 25px;">
				<option value="null" selected>Select...</option>
				<option value="Dirty Bomb Threat">Dirty Bomb Threat</option>
				<option value="Nuclear Bomb Threat">Nuclear Threat</option>
				<option value="Nuclear Proliferation Threat">Nulcear
					Proliferation Threat</option>

			</select> <br> <br>
			<button id="bayes-load">Load</button>
			<button id="bayes-update">Update</button>
			<button id="bayes-reset">Reset</button>

			<script>
				//last update 1/22/14
				//ajax request for xml to load initial nodes and image file
				$(document)
						.ready(
								function() {
									$('#bayes-reset').click(function() {
										$.post('deleteFiles.jsp');

									}); //end rest click

									var dataSource = '';
									var model = '';
									$('#model-database-list').change(
											function() {

												dataSource = $(
														'#model-database-list')
														.val();
											});
									$('#model-list')
											.change(
													function() {

														$('#query-results')
																.html(
																		'<h1>Query Results</h1><p>Click load to display inital model.</p>');
														model = $('#model-list')
																.val();

														//select image
														if (model == "Dirty Bomb Threat") {
															$(
																	'#graphicsDisplay')
																	.html(
																			'<h1>Model Graphic</h1><img src="images/Dirty Bomb Threat BN.jpg" width="450">');

														} else if (model == "Nuclear Bomb Threat") {
															$(
																	'#graphicsDisplay')
																	.html(
																			'<h1>Model Graphic</h1><img src="images/bayes_test3.jpg" width="450">');
														} else if (model == "Nuclear Proliferation Threat") {
															$(
																	'#graphicsDisplay')
																	.html(
																			'<h1>Model Graphic</h1><img src="images/Nuclear Proliferation Threat BN.jpg" width="450">');
														} else
															$(
																	'#graphicsDisplay')
																	.html(
																			'<h1 align="center">No Graphic to Display</h1>');

													}); // end select

									//load inital distribution and graphic
									// changed to ajax request 2/14/14
									$('#bayes-load')
											.click(
													function() {
														var modelString = '';
														modelString = dataSource
																+ '#';
														modelString += model
																+ ':Load'
														console
																.log(modelString);
														$
																.ajax(
																		{
																			type : 'POST',
																			url : 'aAnalytics.jsp',
																			data : {
																				q : modelString
																			},
																			beforeSend : function() {
																				$(
																						'#query-results')
																						.html(
																								'<img src="images/ajax-loader.gif"><p>Retrieving Model...</p>');
																			}
																		})
																.done(
																		function recursionLoad() {
																			var timerLoad = setInterval(
																					function() {
																					},
																					1000)

																			//function waitAndSee(){
																			setTimeout(
																					function() {
																						$
																								.ajax({
																									type : 'GET',
																									url : 'modelBN.xml',
																									beforeSend : function() {
																										$(
																												'#query-results')
																												.html(
																														'<img src="images/ajax-loader.gif"><p>Loading...</p>');
																									},
																									timeout : 10000,
																									error : function(
																											xhr,
																											status,
																											error) {
																										clearInterval(timerLoad);
																										recursionLoad();
																										//alert("Error: " + xhr.status + " - " + error)
																									},
																									dataType : 'xml',
																									cache : false,
																									success : function(
																											data) {
																										clearInterval(timerLoad);
																										var html = '<h3>Nodes</h3><ul class="outer">';
																										$(
																												data)
																												.find(
																														'node')
																												.each(
																														function() { // Each node
																															var node = $(this);
																															html += '<li>'
																																	+ node
																																			.find(
																																					'name')
																																			.text()
																																	+ '<ul class="detail">'; // Embedded list
																															node
																																	.find(
																																			'state')
																																	.each(
																																			function() { // Each node state
																																				html += '<li>'
																																						+ $(
																																								this)
																																								.text()

																																				var prob = $(
																																						this)
																																						.attr(
																																								'prob');
																																				html += ': '
																																						+ prob;
																																				prob = parseFloat(prob);
																																				html += '<div style="height:8px; width:40px;" data-prob="' + prob*100 + '"></div>';

																																			});
																															html += '</ul></li>'
																														});
																										html += '</ul>';
																										$(
																												'#query-results')
																												.html(
																														html)
																												. // Add to DOM
																												on(
																														'click',
																														'> ul > li',
																														function() { // Toggle embedded display on click
																															$(
																																	this)
																																	.find(
																																			'ul')
																																	.toggle();
																															$(
																																	this)
																																	.toggleClass(
																																			'minus');

																														})//.find('ul ul').hide(); // Hide embedded initially

																										$(
																												"[data-prob]")
																												.each(
																														function() {
																															$(
																																	this)
																																	.progressbar(
																																			{
																																				value : $(
																																						this)
																																						.data(
																																								"prob")
																																			})
																															$(
																																	this)
																																	.removeAttr(
																																			"data-prob")
																														});

																										//$('#query-results').html(html); // Add to DOM

																									}//end success

																								});//end ajax

																					},
																					2000); //end wrapper

																		}); // end done
													}); //end click

									//update model
									// changed to ajax request 2/14/14
									$('#bayes-update')
											.click(
													function() {
														var modelString = '';
														modelString = dataSource
																+ '#';
														modelString += model
																+ ':Update'
														console
																.log(modelString);
														$
																.ajax(
																		{
																			type : 'POST',
																			url : 'aAnalytics.jsp',
																			data : {
																				q : modelString
																			},
																			beforeSend : function() {
																				$(
																						'#query-results')
																						.html(
																								'<img src="images/ajax-loader.gif"><p>Updating Model...</p>');
																			}
																		})
																.done(
																		function recursionUpdate() {
																			var timerUpdate = setTimeout(
																					function() {

																					},
																					3000)
																			setTimeout(
																					function() {
																						$
																								.ajax({
																									type : 'GET',
																									url : 'modelBN.xml',
																									beforeSend : function() {
																										$(
																												'#query-results')
																												.html(
																														'<img src="images/ajax-loader.gif"><br>Loading...');
																									},
																									timeout : 10000,
																									error : function(
																											xhr,
																											status,
																											error) {
																										//clearInterval(timerUpdate);
																										recursionUpdate();
																										//alert("Error: " + xhr.status + " - " + error)
																									},
																									dataType : "xml",
																									cache : false,
																									success : function(
																											data) {
																										clearInterval(timerUpdate);
																										var html = '<h3>Nodes</h3><ul class="outer">';
																										$(
																												data)
																												.find(
																														'node')
																												.each(
																														function() { // Each node
																															var node = $(this);
																															html += '<li>'
																																	+ node
																																			.find(
																																					'name')
																																			.text()
																																	+ '<ul class="detail">'; // Embedded list
																															node
																																	.find(
																																			'state')
																																	.each(
																																			function() { // Each node state
																																				html += '<li>'
																																						+ $(
																																								this)
																																								.text()

																																				var prob = $(
																																						this)
																																						.attr(
																																								'prob');
																																				html += ': '
																																						+ prob;
																																				prob = parseFloat(prob);
																																				html += '<div style="height:8px; width:40px;" data-prob="' + prob*100 + '"></div>';

																																			});
																															html += '</ul></li>'
																														});
																										html += '</ul>';
																										$(
																												'#query-results')
																												.html(
																														html)
																												. // Add to DOM
																												on(
																														'click',
																														'> ul > li',
																														function() { // Toggle embedded display on click
																															$(
																																	this)
																																	.find(
																																			'ul')
																																	.toggle();
																															$(
																																	this)
																																	.toggleClass(
																																			'minus');

																														})//.find('ul ul').hide(); // Hide embedded initially

																										$(
																												"[data-prob]")
																												.each(
																														function() {
																															$(
																																	this)
																																	.progressbar(
																																			{
																																				value : $(
																																						this)
																																						.data(
																																								"prob")
																																			})
																															$(
																																	this)
																																	.removeAttr(
																																			"data-prob")
																														})

																										//$('#query-results').html(html); // Add to DOM duplicated for some unknown reason

																									}//end success

																								});//end ajax
																					},
																					2000) // end setTimeout
																		}); //end wrapper

													}); //end click

								}); //end ready
			</script>



		</div>
	</div>

	<section id="query-results" style="overflow: auto;">
		<h1>Query Results</h1>
		<p>Select query from Library tab or Analytics tab to display
			results.</p>
	</section>

	<section id="graphicsDisplay">
		<h1>Geospatial Area of Interest</h1>
		<p>This panel will display, if relevant, a graphic of interest.
			Panel may be split into two as development progresses, a top and
			bottom to allow output of Bayesian Model and other relevant graphic
			such as an interactive map.</p>
	</section>

</body>
</html>

